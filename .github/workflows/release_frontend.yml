# Disabled as hackathon is over. Can be reenabled to reactivate AWS push
# name: Build Frontend Image and push to ECR

# on:
#   push:
#     paths:
#       - 'ac2_frontend/**'
#     branches:
#       - main


# env:
#   AWS_REGION: eu-north-1
#   ECR_REGISTRY: 675175159409.dkr.ecr.eu-north-1.amazonaws.com
#   ECR_REPOSITORY: ac2-frontend
#   PROJECT_NAME: ECS-ac2-frontend
#   ECS_SERVICE: ac2-frontend-service-68b4aa6s
#   ECS_CLUSTER: ac2-brandon-is-very-cool-mh6skg
#   CONTAINER_NAME: ac2-nextjs-frontend
#   TASK_DEFINITION: ac2-frontend
#   TF_VERSION: 1.5.0
#   APP_PORT: 3000

# jobs:
#   build-and-push:
#     name: Build and Push to ECR
#     runs-on: ubuntu-latest
#     outputs:
#       image-tag: "latest"
#       image-uri: "675175159409.dkr.ecr.eu-north-1.amazonaws.com/ac2-frontend"

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4

#     - name: Configure AWS credentials
#       uses: aws-actions/configure-aws-credentials@v4
#       with:
#         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
#         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#         aws-region: ${{ env.AWS_REGION }}

#     - name: Login to Amazon ECR Public
#       id: login-ecr-public
#       uses: aws-actions/amazon-ecr-login@v2
#       with:
#         registry-type: private
#         mask-password: 'true'

#     - name: Build and push Docker image
#       id: build-image
#       working-directory: ./ac2_frontend
#       run: |
#         # Generate image tag using git commit SHA and timestamp
#         IMAGE_TAG="${GITHUB_SHA:0:8}-$(date +%s)"
#         IMAGE_URI="$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG"

#         echo "Building image: $IMAGE_URI"

#         # Build the Docker image
#         docker build -t $IMAGE_URI .

#         # Push the image to ECR
#         docker push $IMAGE_URI

#         # Also tag and push as latest
#         docker tag $IMAGE_URI $ECR_REGISTRY/$ECR_REPOSITORY:latest
#         docker push $ECR_REGISTRY/$ECR_REPOSITORY:latest

#     - name: Force ECS service redeployment
#       run: |
#         aws ecs update-service \
#           --cluster $ECS_CLUSTER \
#           --service $ECS_SERVICE \
#           --force-new-deployment
